<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¸‚æ•™è‚²æœƒå ±åèˆ‡æŸ¥è©¢ç³»çµ±</title>
  <style>
    :root {
      --court-green: #2e7d32;
      --court-green-light: #4caf50;
      --sky-blue: #e3f2fd;
      --btn-blue: #1e88ff;
      --btn-red: #d32f2f;
      --shadow: 0 12px 30px rgba(0,0,0,0.1);
    }
    * { box-sizing: border-box; }
    body {
      font-family: "Microsoft JhengHei", system-ui, sans-serif;
      margin: 0; padding: 30px 15px;
      background: linear-gradient(135deg, var(--sky-blue) 0%, #c8e6c9 100%);
      background-attachment: fixed; min-height: 100vh;
      display: flex; justify-content: center;
    }
    .wrap { width: min(900px, 100%); }
    .title-container { text-align: center; margin-bottom: 25px; }
    h1 {
      background: var(--court-green); color: white;
      padding: 10px 30px; border-radius: 50px;
      display: inline-flex; align-items: center; gap: 12px;
      font-size: clamp(18px, 4.5vw, 28px);
    }
    .nav-buttons { display: flex; justify-content: center; gap: 12px; margin-bottom: 25px; flex-wrap: wrap; }
    .btn {
      padding: 12px 25px; font-size: 16px; font-weight: bold; cursor: pointer;
      border: none; color: white; border-radius: 50px;
      background: linear-gradient(180deg, var(--btn-blue) 0%, #1565c0 100%);
      transition: 0.3s; min-width: 160px;
    }
    .btn:hover { transform: translateY(-3px); }
    .btn-delete {
      background: linear-gradient(180deg, #ff5252 0%, var(--btn-red) 100%);
      padding: 8px 20px; width: 100%; margin-top: 15px; font-weight: bold;
    }
    .section {
      display: none; background: rgba(255, 255, 255, 0.9);
      padding: 25px; border-radius: 20px; box-shadow: var(--shadow);
    }
    .active { display: block; }
    iframe { width: 100%; height: 2500px; border: none; border-radius: 12px; background: white; }
    .search-box { padding-bottom: 20px; border-bottom: 2px dashed #c8e6c9; margin-bottom: 20px; text-align: center;}
    input[type="text"] {
      padding: 12px; width: 220px; border: 2px solid #ddd; border-radius: 12px;
      font-size: 16px; text-align: center;
    }
    .result-card {
      background: white; padding: 25px; margin: 20px 0;
      border-radius: 15px; border-left: 10px solid var(--court-green-light);
      box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: left;
    }
    .player-info { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dashed #eee; }
    .player-info:last-of-type { border-bottom: none; }
    .result-card p { margin: 6px 0; font-size: 16px; line-height: 1.5; }
    .result-card strong { color: var(--court-green); margin-right: 5px; }
    .loading { color: var(--court-green); font-weight: bold; text-align: center; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title-container"><h1>ğŸ¸ å¸‚æ•™è‚²æœƒå ±åç³»çµ±</h1></div>
    <div class="nav-buttons">
      <button class="btn" onclick="showSection('form-section')">å ±åè¡¨å–®</button>
      <button class="btn" onclick="showSection('search-section')">å ±åæŸ¥è©¢/åˆªé™¤</button>
    </div>

    <div id="form-section" class="section active">
      <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSc1Jp8uDL54Gu97IasA5fS7LUxG3GXN6l_0wC3gqUdfzy0NVQ/viewform">è¼‰å…¥ä¸­â€¦</iframe>
    </div>

    <div id="search-section" class="section">
      <div class="search-box">
        <h3>ğŸ¸ è¼¸å…¥èº«åˆ†è­‰å¾Œ5ç¢¼é©—è­‰æŸ¥è©¢</h3>
        <input type="text" id="idInput" placeholder="ä¾‹å¦‚: 12345" maxlength="5" />
        <button class="btn" onclick="searchData()" style="min-width: 100px; margin-top:10px;">æŸ¥è©¢</button>
      </div>
      <div id="result-area"></div>
    </div>
  </div>

  <script>
    // é‡è¦ï¼šè«‹å‹™å¿…æ›¿æ›ç‚ºæ‚¨æœ€æ–°éƒ¨ç½²çš„ GAS ç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€
    var GAS_URL = "https://script.google.com/macros/s/AKfycbweWOJDvhDV0HeM0AnwAZaQR8fwKGCirB2m6GM2OFsSTZIU3VInvqZk8iV22YFFVpsw/exec"; 

    function showSection(id) {
      document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    async function searchData() {
      const idValue = document.getElementById("idInput").value.trim();
      const resultArea = document.getElementById("result-area");
      if (idValue.length !== 5) { alert("è«‹è¼¸å…¥æ­£ç¢ºçš„èº«åˆ†è­‰å¾Œ5ç¢¼"); return; }

      resultArea.innerHTML = '<p class="loading">æ­£åœ¨å°‹æ‰¾æ‚¨çš„åå–®... ğŸ¸</p>';
      try {
        const response = await fetch(`${GAS_URL}?action=search&id=${idValue}`);
        const data = await response.json();

        if (data.length === 0) {
          resultArea.innerHTML = "<p style='text-align:center; color:#d32f2f; font-weight:bold; padding:20px;'>æŸ¥ç„¡å ±åè³‡æ–™ã€‚</p>";
          return;
        }

        let html = "";
        data.forEach(entry => {
          html += `<div class="result-card">
                    <p><strong>çµ„åˆ¥ï¼š</strong>${entry.group}</p>
                    <p><strong>çµ„åˆ¥åºè™Ÿï¼š</strong>${entry.serial}</p><hr style="border:0; border-top:1px solid #eee; margin:15px 0;">`;
          
          entry.players.forEach((p, idx) => {
            html += `<div class="player-info">
                      <p><strong>é¸æ‰‹å§“åï¼š</strong>${p.name}</p>
                      <p><strong>æœå‹™å–®ä½ï¼š</strong>${p.unit}</p>
                      <p><strong>èº«åˆ†è­‰å­—è™Ÿï¼š</strong>${p.id}</p>
                      <p><strong>å‡ºç”Ÿå¹´æœˆæ—¥ï¼š</strong>${p.birthday}</p>
                    </div>`;
          });
          
          html += `<button class="btn btn-delete" onclick="deleteEntry('${idValue}', '${entry.group}')">åˆªé™¤æ•´ç­†å ±åè³‡æ–™</button></div>`;
        });
        resultArea.innerHTML = html;
      } catch (e) {
        resultArea.innerHTML = "<p style='text-align:center; color:red;'>ç³»çµ±é€£ç·šç™¼ç”ŸéŒ¯èª¤ã€‚</p>";
      }
    }

    async function deleteEntry(id5, group) {
      if (!confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${group}ã€çš„é€™ç­†å ±åè³‡æ–™å—ï¼Ÿ`)) return;
      
      const resultArea = document.getElementById("result-area");
      resultArea.innerHTML = '<p class="loading">æ­£åœ¨åˆªé™¤è³‡æ–™ä¸¦é‡æ•´åå†Š... ğŸ¸</p>';

      try {
        const response = await fetch(`${GAS_URL}?action=delete&id=${id5}&group=${encodeURIComponent(group)}`);
        const res = await response.json();
        if (res.status === "success") {
          alert("åˆªé™¤æˆåŠŸï¼");
          searchData(); 
        } else {
          alert("åˆªé™¤å¤±æ•—ï¼š" + res.message);
          searchData();
        }
      } catch (e) {
        alert("è«‹æ±‚ç™¼ç”ŸéŒ¯èª¤ã€‚");
      }
    }
  </script>
</body>
</html>
